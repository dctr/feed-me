{"version":3,"sources":["src/feedFactory.js"],"names":[],"mappings":"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","file":"src/feedFactory.js","sourcesContent":["import AtomFeed from 'AtomFeed.js';\nimport RssFeed from 'RssFeed.js';\n\nconst\n  jsonPCallbackPrefix = 'feedMeJsonP',\n  jsonPTimeout = 10000\n  ;\n\nlet\n  buildYqlUrl,\n  createScriptTag\n  ;\n\nexport default url => {\n  const jsonPCallback = jsonPCallbackPrefix + Math.round(Math.random() * 1000000);\n\n  let\n    appendedScriptTag,\n    appendScriptTag,\n    body,\n    cleanUp,\n    jsonPHandler,\n    rejectPromise,\n    resolvePromise\n    ;\n\n  body = document.getElementsByTagName('body')[0];\n\n  appendScriptTag = url => {\n    appendedScriptTag = body.appendChild(createScriptTag(url));\n  };\n\n  cleanUp = () => {\n    delete window[jsonPCallback];\n    body.removeChild(appendedScriptTag);\n  };\n\n  jsonPHandler = result => {\n    if (result && result.query && result.query.results) {\n      resolvePromise(result.query.results);\n    } else {\n      rejectPromise('No query result data', result);\n    }\n  };\n\n  window[jsonPCallback] = window[jsonPCallback] || jsonPHandler;\n\n  return new Promise((resolve, reject) => {\n    let resolved;\n\n    resolved = false;\n\n    rejectPromise = (reason, data) => {\n      let error;\n\n      resolved = true;\n\n      error = new Error(reason);\n      error.data = data;\n      reject(error);\n\n      cleanUp();\n    };\n\n    resolvePromise = data => {\n      resolved = true;\n\n      if (data.hasOwnProperty('rss')) {\n        resolve(new RssFeed(data));\n      } else if (data.hasOwnProperty('feed')) {\n        resolve(new AtomFeed(data));\n      } else {\n        rejectPromise('Invalid data', data);\n      }\n\n      cleanUp();\n    };\n\n    window.setTimeout(\n      () => {\n        if (!resolved) {\n          rejectPromise('Request timeout', {});\n        }\n      },\n      jsonPTimeout\n    );\n\n    appendScriptTag(buildYqlUrl(url, jsonPCallback));\n  });\n};\n\nbuildYqlUrl = (url, callback) => {\n  const base = 'https://query.yahooapis.com/v1/public/yql?q=';\n\n  let\n    params,\n    query\n    ;\n\n  query = 'select * from xml where url=\"' + url + '\"';\n  params = '&format=json&diagnostics=false&callback=' + callback;\n\n  console.log(base + encodeURIComponent(query) + params);\n\n  return base + encodeURIComponent(query) + params;\n};\n\ncreateScriptTag = url => {\n  let result;\n\n  result = document.createElement('script');\n  result.setAttribute('src', url);\n  return result;\n};\n"]}