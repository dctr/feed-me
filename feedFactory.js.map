{"version":3,"sources":["src/feedFactory.js"],"names":[],"mappings":"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","file":"src/feedFactory.js","sourcesContent":["import AtomFeed from 'AtomFeed.js';\nimport RssFeed from 'RssFeed.js';\n\nconst jsonPCallbackPrefix = 'feedMeJsonP',\n  jsonPTimeout = 10000;\n\nexport default url => {\n  const jsonPCallback = jsonPCallbackPrefix + Math.round(Math.random() * 1000000);\n\n  let appendedChild,\n    body,\n    resolvePromise;\n\n  body = document.getElementsByTagName('body')[0];\n\n  function cleanUp() {\n    delete window[jsonPCallback];\n    body.removeChild(appendedChild);\n  }\n\n  function addScriptTagForUrl(url) {\n    appendedChild = body.appendChild(createScriptTag(url));\n  }\n\n  function jsonPHandler(result) {\n    if (!(result.query && result.query.results)) {\n      console.log('Error while retrieving data');\n      console.log(result);\n    }\n    resolvePromise(result.query.results);\n  }\n\n  window[jsonPCallback] = window[jsonPCallback] || jsonPHandler;\n\n  return new Promise((resolve, reject) => {\n    let resolved;\n\n    resolved = false;\n\n    resolvePromise = data => {\n      resolved = true;\n      if (!data) {\n        reject(new Error('No data'));\n      } else if (data.hasOwnProperty('rss')) {\n        resolve(new RssFeed(data));\n      } else if (data.hasOwnProperty('feed')) {\n        resolve(new AtomFeed(data));\n      } else {\n        reject(new Error('Invalid data'));\n      }\n      cleanUp();\n    };\n\n    window.setTimeout(\n      () => {\n        if (!resolved) {\n          reject(new Error('Request timeout'));\n          cleanUp();\n        }\n      },\n      jsonPTimeout\n    );\n\n    addScriptTagForUrl(buildYqlUrl(url, jsonPCallback));\n  });\n};\n\nfunction buildYqlUrl(url, callback) {\n  const base = 'https://query.yahooapis.com/v1/public/yql?q=';\n\n  let params,\n    query;\n\n  query = 'select * from xml where url=\"' + url + '\"';\n  params = '&format=json&diagnostics=false&callback=' + callback;\n\n  return base + encodeURIComponent(query) + params;\n}\n\nfunction createScriptTag(url) {\n  let result;\n\n  result = document.createElement('script');\n  result.setAttribute('src', url);\n  return result;\n}\n"]}